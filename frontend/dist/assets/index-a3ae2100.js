import{a as de,o as ne,b as r,D as ue,c,e as P,g as e,w as a,f as i,m as C,F as ie,G as B,H as S,I,J as me,K as pe,L as fe,M as ge,z as _e,N as ce,j as T,O as be,i as q,h as b,E as N,C as ve}from"./index-285e75c9.js";const we={class:"user-management"},Ve={class:"card-header"},ye={class:"pagination"},Ce={class:"dialog-footer"},xe={class:"dialog-footer"},ke={__name:"index",setup(Ue){const u=q({username:"",name:"",deptId:"",status:""}),m=q({current:1,size:10,total:0}),z=b(!1),$=b([]),O=b([{id:1,name:"技术部"},{id:2,name:"销售部"},{id:3,name:"市场部"},{id:4,name:"财务部"}]),L=b([{id:1,roleName:"管理员"},{id:2,roleName:"销售经理"},{id:3,roleName:"销售顾问"},{id:4,roleName:"普通用户"}]),y=b(!1),x=b(!1),k=b("add"),F=b(null),R=b(null),o=q({id:"",username:"",name:"",deptId:"",roleIds:[],email:"",phone:"",password:"",status:"1"}),v=q({password:"",confirmPassword:""}),M={username:[{required:!0,message:"请输入用户账号",trigger:"blur"},{min:2,max:20,message:"账号长度在 2 到 20 个字符",trigger:"blur"}],name:[{required:!0,message:"请输入用户姓名",trigger:"blur"},{min:2,max:20,message:"姓名长度在 2 到 20 个字符",trigger:"blur"}],deptId:[{required:!0,message:"请选择部门",trigger:"blur"}],roleIds:[{required:!0,message:"请选择角色",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"请输入正确的邮箱格式",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号格式",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},A={password:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(s,l,g)=>{l!==v.password?g(new Error("两次输入的密码不一致")):g()},trigger:"blur"}]},w=async()=>{z.value=!0;try{setTimeout(()=>{$.value=[{id:1,username:"admin",name:"管理员",deptId:1,deptName:"技术部",roleIds:[1],roleNames:"管理员",email:"admin@example.com",phone:"13800138000",status:"1",createTime:"2023-01-01 10:00:00"},{id:2,username:"user",name:"普通用户",deptId:2,deptName:"销售部",roleIds:[4],roleNames:"普通用户",email:"user@example.com",phone:"13900139000",status:"1",createTime:"2023-01-02 10:00:00"}],m.total=2,z.value=!1},500)}catch(s){console.error("获取用户列表失败:",s),N.error("获取用户列表失败"),z.value=!1}},G=()=>{m.current=1,w()},H=()=>{Object.keys(u).forEach(s=>{u[s]=""}),m.current=1,w()},J=s=>{m.size=s,w()},K=s=>{m.current=s,w()},Q=()=>{k.value="add",Object.keys(o).forEach(s=>{o[s]=""}),o.status="1",o.roleIds=[],y.value=!0},W=s=>{k.value="edit",Object.assign(o,s),y.value=!0},X=async()=>{if(F.value)try{await F.value.validate(),setTimeout(()=>{y.value=!1,N.success(k.value==="add"?"新增用户成功":"编辑用户成功"),w()},500)}catch(s){console.error("表单验证失败:",s)}},Y=s=>{v.password="",v.confirmPassword="",x.value=!0},Z=async()=>{if(R.value)try{await R.value.validate(),setTimeout(()=>{x.value=!1,N.success("重置密码成功")},500)}catch(s){console.error("表单验证失败:",s)}},ee=s=>{setTimeout(()=>{N.success("状态更新成功")},500)},le=s=>{ve.confirm("确定要删除该用户吗？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{setTimeout(()=>{N.success("删除用户成功"),w()},500)}).catch(()=>{})};return ne(()=>{w()}),(s,l)=>{const g=r("el-icon"),p=r("el-button"),_=r("el-input"),d=r("el-form-item"),n=r("el-col"),V=r("el-option"),U=r("el-select"),j=r("el-row"),E=r("el-form"),f=r("el-table-column"),ae=r("el-switch"),te=r("el-table"),oe=r("el-pagination"),se=r("el-card"),D=r("el-dialog"),re=ue("loading");return c(),P("div",we,[e(se,null,{header:a(()=>[i("div",Ve,[l[21]||(l[21]=i("span",null,"用户管理",-1)),e(p,{type:"primary",onClick:Q},{default:a(()=>[e(g,null,{default:a(()=>[e(C(ie))]),_:1}),l[20]||(l[20]=i("span",null,"新增用户",-1))]),_:1})])]),default:a(()=>[e(E,{model:u,class:"search-form","label-width":"80px"},{default:a(()=>[e(j,{gutter:20},{default:a(()=>[e(n,{span:6},{default:a(()=>[e(d,{label:"用户账号"},{default:a(()=>[e(_,{modelValue:u.username,"onUpdate:modelValue":l[0]||(l[0]=t=>u.username=t),placeholder:"请输入用户账号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:a(()=>[e(d,{label:"用户姓名"},{default:a(()=>[e(_,{modelValue:u.name,"onUpdate:modelValue":l[1]||(l[1]=t=>u.name=t),placeholder:"请输入用户姓名",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:a(()=>[e(d,{label:"部门"},{default:a(()=>[e(U,{modelValue:u.deptId,"onUpdate:modelValue":l[2]||(l[2]=t=>u.deptId=t),placeholder:"请选择部门",clearable:""},{default:a(()=>[(c(!0),P(B,null,S(O.value,t=>(c(),I(V,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:6},{default:a(()=>[e(d,{label:"状态"},{default:a(()=>[e(U,{modelValue:u.status,"onUpdate:modelValue":l[3]||(l[3]=t=>u.status=t),placeholder:"请选择状态",clearable:""},{default:a(()=>[e(V,{label:"启用",value:"1"}),e(V,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:24,class:"search-buttons"},{default:a(()=>[e(p,{type:"primary",onClick:G},{default:a(()=>[e(g,null,{default:a(()=>[e(C(me))]),_:1}),l[22]||(l[22]=i("span",null,"查询",-1))]),_:1}),e(p,{onClick:H},{default:a(()=>[e(g,null,{default:a(()=>[e(C(pe))]),_:1}),l[23]||(l[23]=i("span",null,"重置",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),fe((c(),I(te,{data:$.value,style:{width:"100%"},border:""},{default:a(()=>[e(f,{prop:"id",label:"用户ID",width:"80"}),e(f,{prop:"username",label:"用户账号",width:"120"}),e(f,{prop:"name",label:"用户姓名",width:"120"}),e(f,{prop:"deptName",label:"所属部门",width:"150"}),e(f,{prop:"roleNames",label:"角色",width:"200"}),e(f,{prop:"email",label:"邮箱",width:"180"}),e(f,{prop:"phone",label:"手机号",width:"150"}),e(f,{prop:"status",label:"状态",width:"100"},{default:a(t=>[e(ae,{modelValue:t.row.status,"onUpdate:modelValue":h=>t.row.status=h,"active-value":"1","inactive-value":"0",onChange:h=>ee(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(f,{prop:"createTime",label:"创建时间",width:"180"}),e(f,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[e(p,{type:"primary",size:"small",onClick:h=>W(t.row)},{default:a(()=>[e(g,null,{default:a(()=>[e(C(ge))]),_:1}),l[24]||(l[24]=i("span",null,"编辑",-1))]),_:1},8,["onClick"]),e(p,{type:"warning",size:"small",onClick:h=>Y(t.row)},{default:a(()=>[e(g,null,{default:a(()=>[e(C(_e))]),_:1}),l[25]||(l[25]=i("span",null,"重置密码",-1))]),_:1},8,["onClick"]),e(p,{type:"danger",size:"small",onClick:h=>le(t.row.id)},{default:a(()=>[e(g,null,{default:a(()=>[e(C(ce))]),_:1}),l[26]||(l[26]=i("span",null,"删除",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,z.value]]),i("div",ye,[e(oe,{"current-page":m.current,"onUpdate:currentPage":l[4]||(l[4]=t=>m.current=t),"page-size":m.size,"onUpdate:pageSize":l[5]||(l[5]=t=>m.size=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:m.total,onSizeChange:J,onCurrentChange:K},null,8,["current-page","page-size","total"])])]),_:1}),e(D,{modelValue:y.value,"onUpdate:modelValue":l[15]||(l[15]=t=>y.value=t),title:k.value==="add"?"新增用户":"编辑用户",width:"700px"},{footer:a(()=>[i("span",Ce,[e(p,{onClick:l[14]||(l[14]=t=>y.value=!1)},{default:a(()=>[...l[27]||(l[27]=[T("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:X},{default:a(()=>[...l[28]||(l[28]=[T("确定",-1)])]),_:1})])]),default:a(()=>[e(E,{model:o,rules:M,ref_key:"userFormRef",ref:F,"label-width":"100px"},{default:a(()=>[e(j,{gutter:20},{default:a(()=>[e(n,{span:12},{default:a(()=>[e(d,{prop:"username"},{default:a(()=>[e(_,{modelValue:o.username,"onUpdate:modelValue":l[6]||(l[6]=t=>o.username=t),placeholder:"请输入用户账号"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(d,{prop:"name"},{default:a(()=>[e(_,{modelValue:o.name,"onUpdate:modelValue":l[7]||(l[7]=t=>o.name=t),placeholder:"请输入用户姓名"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(d,{prop:"deptId"},{default:a(()=>[e(U,{modelValue:o.deptId,"onUpdate:modelValue":l[8]||(l[8]=t=>o.deptId=t),placeholder:"请选择部门"},{default:a(()=>[(c(!0),P(B,null,S(O.value,t=>(c(),I(V,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(d,{prop:"roleIds"},{default:a(()=>[e(U,{modelValue:o.roleIds,"onUpdate:modelValue":l[9]||(l[9]=t=>o.roleIds=t),multiple:"",placeholder:"请选择角色"},{default:a(()=>[(c(!0),P(B,null,S(L.value,t=>(c(),I(V,{key:t.id,label:t.roleName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(d,{prop:"email"},{default:a(()=>[e(_,{modelValue:o.email,"onUpdate:modelValue":l[10]||(l[10]=t=>o.email=t),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[e(d,{prop:"phone"},{default:a(()=>[e(_,{modelValue:o.phone,"onUpdate:modelValue":l[11]||(l[11]=t=>o.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1})]),_:1}),e(n,{span:12},{default:a(()=>[k.value==="add"?(c(),I(d,{key:0,prop:"password"},{default:a(()=>[e(_,{modelValue:o.password,"onUpdate:modelValue":l[12]||(l[12]=t=>o.password=t),type:"password",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})):be("",!0)]),_:1}),e(n,{span:12},{default:a(()=>[e(d,{prop:"status"},{default:a(()=>[e(U,{modelValue:o.status,"onUpdate:modelValue":l[13]||(l[13]=t=>o.status=t),placeholder:"请选择状态"},{default:a(()=>[e(V,{label:"启用",value:"1"}),e(V,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(D,{modelValue:x.value,"onUpdate:modelValue":l[19]||(l[19]=t=>x.value=t),title:"重置密码",width:"400px"},{footer:a(()=>[i("span",xe,[e(p,{onClick:l[18]||(l[18]=t=>x.value=!1)},{default:a(()=>[...l[29]||(l[29]=[T("取消",-1)])]),_:1}),e(p,{type:"primary",onClick:Z},{default:a(()=>[...l[30]||(l[30]=[T("确定",-1)])]),_:1})])]),default:a(()=>[e(E,{model:v,rules:A,ref_key:"resetPasswordFormRef",ref:R,"label-width":"100px"},{default:a(()=>[e(d,{label:"新密码"},{default:a(()=>[e(_,{modelValue:v.password,"onUpdate:modelValue":l[16]||(l[16]=t=>v.password=t),type:"password",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),e(d,{label:"确认密码"},{default:a(()=>[e(_,{modelValue:v.confirmPassword,"onUpdate:modelValue":l[17]||(l[17]=t=>v.confirmPassword=t),type:"password",placeholder:"请确认新密码"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ie=de(ke,[["__scopeId","data-v-309789a1"]]);export{Ie as default};
