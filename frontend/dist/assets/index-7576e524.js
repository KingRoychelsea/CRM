import{a as Ve,o as we,b as r,D as Ne,c as m,e as D,g as e,w as l,f as d,m as b,F as ke,G as z,H as S,I as U,J as Ie,K as Ce,Q as De,L as Ue,t as K,j as N,M as xe,R as Te,T as ze,P as Q,i as q,h as f,E as k}from"./index-285e75c9.js";const Se={class:"contract-management"},Fe={class:"card-header"},$e={class:"pagination"},qe={class:"dialog-footer"},Re={class:"dialog-footer"},Ee={class:"dialog-footer"},je={__name:"index",setup(Le){const c=q({contractNo:"",customerId:"",status:"",ownerId:""}),v=q({current:1,size:10,total:0}),F=f(!1),H=f([]),M=f([{id:1,customerName:"阿里巴巴集团"},{id:2,customerName:"腾讯科技"},{id:3,customerName:"百度在线"},{id:4,customerName:"字节跳动"}]),W=f([{id:1,opportunityName:"阿里云服务器采购"},{id:2,opportunityName:"腾讯云存储服务"},{id:3,opportunityName:"百度推广服务"},{id:4,opportunityName:"字节跳动广告投放"}]),A=f([{id:1,name:"管理员"},{id:2,name:"销售1"},{id:3,name:"销售2"}]),R={0:{label:"草稿",type:"info",effect:"dark"},1:{label:"生效",type:"success",effect:"dark"},2:{label:"终止",type:"danger",effect:"dark"},3:{label:"过期",type:"warning",effect:"dark"}},I=f(!1),x=f(!1),T=f(!1),$=f("add"),E=f(null),j=f(null),o=q({id:"",contractNo:"",contractName:"",customerId:"",opportunityId:"",amount:0,startDate:"",endDate:"",ownerId:"",status:"0",description:""}),V=q({status:"",remark:""}),P=f([]),X={contractNo:[{required:!0,message:"请输入合同编号",trigger:"blur"},{min:2,max:50,message:"合同编号长度在 2 到 50 个字符",trigger:"blur"}],contractName:[{required:!0,message:"请输入合同名称",trigger:"blur"},{min:2,max:100,message:"合同名称长度在 2 到 100 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"blur"}],amount:[{required:!0,message:"请输入合同金额",trigger:"blur"},{type:"number",min:0,message:"合同金额必须大于等于0",trigger:"blur"}],startDate:[{required:!0,message:"请选择开始日期",trigger:"blur"}],endDate:[{required:!0,message:"请选择结束日期",trigger:"blur"}],ownerId:[{required:!0,message:"请选择负责人",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},Y={status:[{required:!0,message:"请选择合同状态",trigger:"blur"}]},w=async()=>{F.value=!0;try{setTimeout(()=>{H.value=[{id:1,contractNo:"HT2023001",contractName:"阿里云服务器采购合同",customerId:1,customerName:"阿里巴巴集团",opportunityId:1,amount:1e6,startDate:"2023-01-01",endDate:"2024-01-01",status:"1",ownerId:1,ownerName:"管理员",createTime:"2023-01-01 10:00:00"},{id:2,contractNo:"HT2023002",contractName:"腾讯云存储服务合同",customerId:2,customerName:"腾讯科技",opportunityId:2,amount:5e5,startDate:"2023-01-02",endDate:"2024-01-02",status:"0",ownerId:2,ownerName:"销售1",createTime:"2023-01-02 10:00:00"},{id:3,contractNo:"HT2023003",contractName:"百度推广服务合同",customerId:3,customerName:"百度在线",opportunityId:3,amount:3e5,startDate:"2023-01-03",endDate:"2024-01-03",status:"1",ownerId:3,ownerName:"销售2",createTime:"2023-01-03 10:00:00"},{id:4,contractNo:"HT2023004",contractName:"字节跳动广告投放合同",customerId:4,customerName:"字节跳动",opportunityId:4,amount:2e6,startDate:"2023-01-04",endDate:"2024-01-04",status:"2",ownerId:1,ownerName:"管理员",createTime:"2023-01-04 10:00:00"}],v.total=4,F.value=!1},500)}catch(n){console.error("获取合同列表失败:",n),k.error("获取合同列表失败"),F.value=!1}},Z=()=>{v.current=1,w()},h=()=>{Object.keys(c).forEach(n=>{c[n]=""}),v.current=1,w()},ee=n=>{v.size=n,w()},te=n=>{v.current=n,w()},le=()=>{$.value="add",Object.keys(o).forEach(n=>{o[n]=""}),o.status="0",o.amount=0,I.value=!0},ae=n=>{$.value="edit",Object.assign(o,n),I.value=!0},oe=async()=>{if(E.value)try{await E.value.validate(),setTimeout(()=>{I.value=!1,k.success($.value==="add"?"新增合同成功":"编辑合同成功"),w()},500)}catch(n){console.error("表单验证失败:",n)}},ne=n=>{k.info("查看合同详情功能开发中")},ue=n=>{V.status=n.status,V.remark="",x.value=!0},re=async()=>{if(j.value)try{await j.value.validate(),setTimeout(()=>{x.value=!1,k.success("更新合同状态成功"),w()},500)}catch(n){console.error("表单验证失败:",n)}},de=n=>{P.value=[],T.value=!0},se=n=>{console.log("预览文件:",n)},ie=(n,t)=>{console.log("移除文件:",n,t)},pe=(n,t)=>{k.warning("最多只能上传5个文件")},me=()=>{setTimeout(()=>{T.value=!1,k.success("上传附件成功")},500)},fe=()=>{setTimeout(()=>{k.success("导出合同成功")},500)};return we(()=>{w()}),(n,t)=>{const g=r("el-icon"),i=r("el-button"),C=r("el-input"),s=r("el-form-item"),p=r("el-col"),u=r("el-option"),y=r("el-select"),G=r("el-row"),L=r("el-form"),_=r("el-table-column"),ce=r("el-tag"),_e=r("el-table"),ve=r("el-pagination"),ge=r("el-card"),J=r("el-date-picker"),O=r("el-dialog"),be=r("el-upload"),ye=Ne("loading");return m(),D("div",Se,[e(ge,null,{header:l(()=>[d("div",Fe,[t[26]||(t[26]=d("span",null,"合同管理",-1)),e(i,{type:"primary",onClick:le},{default:l(()=>[e(g,null,{default:l(()=>[e(b(ke))]),_:1}),t[25]||(t[25]=d("span",null,"新增合同",-1))]),_:1})])]),default:l(()=>[e(L,{model:c,class:"search-form","label-width":"80px"},{default:l(()=>[e(G,{gutter:20},{default:l(()=>[e(p,{span:6},{default:l(()=>[e(s,{label:"合同编号"},{default:l(()=>[e(C,{modelValue:c.contractNo,"onUpdate:modelValue":t[0]||(t[0]=a=>c.contractNo=a),placeholder:"请输入合同编号",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(s,{label:"客户名称"},{default:l(()=>[e(y,{modelValue:c.customerId,"onUpdate:modelValue":t[1]||(t[1]=a=>c.customerId=a),placeholder:"请选择客户",clearable:""},{default:l(()=>[(m(!0),D(z,null,S(M.value,a=>(m(),U(u,{key:a.id,label:a.customerName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(s,{label:"合同状态"},{default:l(()=>[e(y,{modelValue:c.status,"onUpdate:modelValue":t[2]||(t[2]=a=>c.status=a),placeholder:"请选择合同状态",clearable:""},{default:l(()=>[e(u,{label:"草稿",value:"0"}),e(u,{label:"生效",value:"1"}),e(u,{label:"终止",value:"2"}),e(u,{label:"过期",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(s,{label:"负责人"},{default:l(()=>[e(y,{modelValue:c.ownerId,"onUpdate:modelValue":t[3]||(t[3]=a=>c.ownerId=a),placeholder:"请选择负责人",clearable:""},{default:l(()=>[(m(!0),D(z,null,S(A.value,a=>(m(),U(u,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:24,class:"search-buttons"},{default:l(()=>[e(i,{type:"primary",onClick:Z},{default:l(()=>[e(g,null,{default:l(()=>[e(b(Ie))]),_:1}),t[27]||(t[27]=d("span",null,"查询",-1))]),_:1}),e(i,{onClick:h},{default:l(()=>[e(g,null,{default:l(()=>[e(b(Ce))]),_:1}),t[28]||(t[28]=d("span",null,"重置",-1))]),_:1}),e(i,{type:"success",onClick:fe},{default:l(()=>[e(g,null,{default:l(()=>[e(b(De))]),_:1}),t[29]||(t[29]=d("span",null,"导出合同",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),Ue((m(),U(_e,{data:H.value,style:{width:"100%"},border:""},{default:l(()=>[e(_,{prop:"id",label:"合同ID",width:"80"}),e(_,{prop:"contractNo",label:"合同编号",width:"150"}),e(_,{prop:"contractName",label:"合同名称",width:"200"}),e(_,{prop:"customerName",label:"客户名称",width:"150"}),e(_,{prop:"amount",label:"合同金额",width:"120"},{default:l(a=>[d("span",null,"¥"+K(a.row.amount.toFixed(2)),1)]),_:1}),e(_,{prop:"startDate",label:"开始日期",width:"150"}),e(_,{prop:"endDate",label:"结束日期",width:"150"}),e(_,{prop:"status",label:"状态",width:"100"},{default:l(a=>[e(ce,{type:R[a.row.status].type,effect:R[a.row.status].effect},{default:l(()=>[N(K(R[a.row.status].label),1)]),_:2},1032,["type","effect"])]),_:1}),e(_,{prop:"ownerName",label:"负责人",width:"100"}),e(_,{prop:"createTime",label:"创建时间",width:"180"}),e(_,{label:"操作",width:"300",fixed:"right"},{default:l(a=>[e(i,{type:"primary",size:"small",onClick:B=>ae(a.row)},{default:l(()=>[e(g,null,{default:l(()=>[e(b(xe))]),_:1}),t[30]||(t[30]=d("span",null,"编辑",-1))]),_:1},8,["onClick"]),e(i,{type:"success",size:"small",onClick:B=>ne(a.row)},{default:l(()=>[e(g,null,{default:l(()=>[e(b(Te))]),_:1}),t[31]||(t[31]=d("span",null,"详情",-1))]),_:1},8,["onClick"]),e(i,{type:"warning",size:"small",onClick:B=>ue(a.row)},{default:l(()=>[e(g,null,{default:l(()=>[e(b(ze))]),_:1}),t[32]||(t[32]=d("span",null,"更新状态",-1))]),_:1},8,["onClick"]),e(i,{type:"info",size:"small",onClick:B=>de(a.row)},{default:l(()=>[e(g,null,{default:l(()=>[e(b(Q))]),_:1}),t[33]||(t[33]=d("span",null,"附件",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,F.value]]),d("div",$e,[e(ve,{"current-page":v.current,"onUpdate:currentPage":t[4]||(t[4]=a=>v.current=a),"page-size":v.size,"onUpdate:pageSize":t[5]||(t[5]=a=>v.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:v.total,onSizeChange:ee,onCurrentChange:te},null,8,["current-page","page-size","total"])])]),_:1}),e(O,{modelValue:I.value,"onUpdate:modelValue":t[17]||(t[17]=a=>I.value=a),title:$.value==="add"?"新增合同":"编辑合同",width:"700px"},{footer:l(()=>[d("span",qe,[e(i,{onClick:t[16]||(t[16]=a=>I.value=!1)},{default:l(()=>[...t[34]||(t[34]=[N("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:oe},{default:l(()=>[...t[35]||(t[35]=[N("确定",-1)])]),_:1})])]),default:l(()=>[e(L,{model:o,rules:X,ref_key:"contractFormRef",ref:E,"label-width":"100px"},{default:l(()=>[e(G,{gutter:20},{default:l(()=>[e(p,{span:12},{default:l(()=>[e(s,{prop:"contractNo"},{default:l(()=>[e(C,{modelValue:o.contractNo,"onUpdate:modelValue":t[6]||(t[6]=a=>o.contractNo=a),placeholder:"请输入合同编号"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"contractName"},{default:l(()=>[e(C,{modelValue:o.contractName,"onUpdate:modelValue":t[7]||(t[7]=a=>o.contractName=a),placeholder:"请输入合同名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"customerId"},{default:l(()=>[e(y,{modelValue:o.customerId,"onUpdate:modelValue":t[8]||(t[8]=a=>o.customerId=a),placeholder:"请选择客户"},{default:l(()=>[(m(!0),D(z,null,S(M.value,a=>(m(),U(u,{key:a.id,label:a.customerName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"opportunityId"},{default:l(()=>[e(y,{modelValue:o.opportunityId,"onUpdate:modelValue":t[9]||(t[9]=a=>o.opportunityId=a),placeholder:"请选择关联商机"},{default:l(()=>[(m(!0),D(z,null,S(W.value,a=>(m(),U(u,{key:a.id,label:a.opportunityName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"amount"},{default:l(()=>[e(C,{modelValue:o.amount,"onUpdate:modelValue":t[10]||(t[10]=a=>o.amount=a),type:"number",placeholder:"请输入合同金额"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"startDate"},{default:l(()=>[e(J,{modelValue:o.startDate,"onUpdate:modelValue":t[11]||(t[11]=a=>o.startDate=a),type:"date",placeholder:"请选择开始日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"endDate"},{default:l(()=>[e(J,{modelValue:o.endDate,"onUpdate:modelValue":t[12]||(t[12]=a=>o.endDate=a),type:"date",placeholder:"请选择结束日期",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"ownerId"},{default:l(()=>[e(y,{modelValue:o.ownerId,"onUpdate:modelValue":t[13]||(t[13]=a=>o.ownerId=a),placeholder:"请选择负责人"},{default:l(()=>[(m(!0),D(z,null,S(A.value,a=>(m(),U(u,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"status"},{default:l(()=>[e(y,{modelValue:o.status,"onUpdate:modelValue":t[14]||(t[14]=a=>o.status=a),placeholder:"请选择状态"},{default:l(()=>[e(u,{label:"草稿",value:"0"}),e(u,{label:"生效",value:"1"}),e(u,{label:"终止",value:"2"}),e(u,{label:"过期",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(s,{prop:"description"},{default:l(()=>[e(C,{modelValue:o.description,"onUpdate:modelValue":t[15]||(t[15]=a=>o.description=a),type:"textarea",placeholder:"请输入合同描述"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(O,{modelValue:x.value,"onUpdate:modelValue":t[21]||(t[21]=a=>x.value=a),title:"更新合同状态",width:"400px"},{footer:l(()=>[d("span",Re,[e(i,{onClick:t[20]||(t[20]=a=>x.value=!1)},{default:l(()=>[...t[36]||(t[36]=[N("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:re},{default:l(()=>[...t[37]||(t[37]=[N("确定",-1)])]),_:1})])]),default:l(()=>[e(L,{model:V,rules:Y,ref_key:"updateStatusFormRef",ref:j},{default:l(()=>[e(s,{label:"合同状态",prop:"status"},{default:l(()=>[e(y,{modelValue:V.status,"onUpdate:modelValue":t[18]||(t[18]=a=>V.status=a),placeholder:"请选择合同状态"},{default:l(()=>[e(u,{label:"草稿",value:"0"}),e(u,{label:"生效",value:"1"}),e(u,{label:"终止",value:"2"}),e(u,{label:"过期",value:"3"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"备注",prop:"remark"},{default:l(()=>[e(C,{modelValue:V.remark,"onUpdate:modelValue":t[19]||(t[19]=a=>V.remark=a),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(O,{modelValue:T.value,"onUpdate:modelValue":t[24]||(t[24]=a=>T.value=a),title:"上传合同附件",width:"500px"},{footer:l(()=>[d("span",Ee,[e(i,{onClick:t[23]||(t[23]=a=>T.value=!1)},{default:l(()=>[...t[40]||(t[40]=[N("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:me},{default:l(()=>[...t[41]||(t[41]=[N("上传",-1)])]),_:1})])]),default:l(()=>[e(be,{class:"upload-demo",action:"#","on-preview":se,"on-remove":ie,"file-list":P.value,"auto-upload":!1,limit:5,"on-exceed":pe},{tip:l(()=>[...t[39]||(t[39]=[d("div",{class:"el-upload__tip"}," 只能上传jpg/png文件，且不超过5MB ",-1)])]),default:l(()=>[e(i,{type:"primary",onClick:t[22]||(t[22]=a=>n.$refs.upload.$refs.input.click())},{default:l(()=>[e(g,null,{default:l(()=>[e(b(Q))]),_:1}),t[38]||(t[38]=d("span",null,"选择文件",-1))]),_:1})]),_:1},8,["file-list"])]),_:1},8,["modelValue"])])}}},Be=Ve(je,[["__scopeId","data-v-160670c0"]]);export{Be as default};
