import{a as ye,o as we,b as r,D as Ve,c as _,e as R,g as e,w as l,f as d,m as w,F as ke,G as h,H as E,I as S,J as Ce,K as xe,L as Ne,j as x,t as K,M as Ie,R as Te,T as Ue,S as Fe,A as Re,i as z,h as f,E as N}from"./index-285e75c9.js";const Se={class:"opportunity-management"},ze={class:"card-header"},Oe={class:"pagination"},qe={class:"dialog-footer"},$e={class:"dialog-footer"},he={class:"dialog-footer"},Ee={__name:"index",setup(je){const m=z({opportunityName:"",customerId:"",stage:"",ownerId:""}),g=z({current:1,size:10,total:0}),O=f(!1),A=f([]),G=f([{id:1,customerName:"阿里巴巴集团"},{id:2,customerName:"腾讯科技"},{id:3,customerName:"百度在线"},{id:4,customerName:"字节跳动"}]),H=f([{id:1,name:"管理员"},{id:2,name:"销售1"},{id:3,name:"销售2"}]),j={0:{label:"初步接洽",type:"info",effect:"dark"},1:{label:"需求确认",type:"warning",effect:"dark"},2:{label:"方案报价",type:"success",effect:"dark"},3:{label:"合同签订",type:"primary",effect:"dark"}},I=f(!1),U=f(!1),F=f(!1),q=f("add"),D=f(null),B=f(null),L=f(null),u=z({id:"",opportunityName:"",customerId:"",stage:"0",amount:0,ownerId:"",nextFollowTime:"",description:"",status:"1"}),V=z({stage:"",remark:""}),k=z({closeReason:"",convertToContract:!1}),P={opportunityName:[{required:!0,message:"请输入商机名称",trigger:"blur"},{min:2,max:50,message:"商机名称长度在 2 到 50 个字符",trigger:"blur"}],customerId:[{required:!0,message:"请选择客户",trigger:"blur"}],stage:[{required:!0,message:"请选择商机阶段",trigger:"blur"}],amount:[{required:!0,message:"请输入商机金额",trigger:"blur"},{type:"number",min:0,message:"商机金额必须大于等于0",trigger:"blur"}],ownerId:[{required:!0,message:"请选择负责人",trigger:"blur"}],nextFollowTime:[{required:!0,message:"请选择下次跟进时间",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"blur"}]},Q={stage:[{required:!0,message:"请选择商机阶段",trigger:"blur"}]},W={closeReason:[{required:!0,message:"请输入关闭原因",trigger:"blur"},{min:5,max:200,message:"关闭原因长度在 5 到 200 个字符",trigger:"blur"}]},v=async()=>{O.value=!0;try{setTimeout(()=>{A.value=[{id:1,opportunityName:"阿里云服务器采购",customerId:1,customerName:"阿里巴巴集团",stage:"2",amount:1e6,ownerId:1,ownerName:"管理员",nextFollowTime:"2023-01-15 10:00:00",status:"1",createTime:"2023-01-01 10:00:00"},{id:2,opportunityName:"腾讯云存储服务",customerId:2,customerName:"腾讯科技",stage:"1",amount:5e5,ownerId:2,ownerName:"销售1",nextFollowTime:"2023-01-10 14:00:00",status:"1",createTime:"2023-01-02 10:00:00"},{id:3,opportunityName:"百度推广服务",customerId:3,customerName:"百度在线",stage:"0",amount:3e5,ownerId:3,ownerName:"销售2",nextFollowTime:"2023-01-08 09:00:00",status:"1",createTime:"2023-01-03 10:00:00"},{id:4,opportunityName:"字节跳动广告投放",customerId:4,customerName:"字节跳动",stage:"3",amount:2e6,ownerId:1,ownerName:"管理员",nextFollowTime:"2023-01-20 15:00:00",status:"0",createTime:"2023-01-04 10:00:00"}],g.total=4,O.value=!1},500)}catch(o){console.error("获取商机列表失败:",o),N.error("获取商机列表失败"),O.value=!1}},X=()=>{g.current=1,v()},Y=()=>{Object.keys(m).forEach(o=>{m[o]=""}),g.current=1,v()},Z=o=>{g.size=o,v()},ee=o=>{g.current=o,v()},le=()=>{q.value="add",Object.keys(u).forEach(o=>{u[o]=""}),u.stage="0",u.amount=0,u.status="1",I.value=!0},te=o=>{q.value="edit",Object.assign(u,o),I.value=!0},ae=async()=>{if(D.value)try{await D.value.validate(),setTimeout(()=>{I.value=!1,N.success(q.value==="add"?"新增商机成功":"编辑商机成功"),v()},500)}catch(o){console.error("表单验证失败:",o)}},oe=o=>{N.info("查看商机详情功能开发中")},ue=o=>{setTimeout(()=>{N.success("状态更新成功")},500)},ne=o=>{V.stage=o.stage,V.remark="",U.value=!0},re=async()=>{if(B.value)try{await B.value.validate(),setTimeout(()=>{U.value=!1,N.success("更新商机阶段成功"),v()},500)}catch(o){console.error("表单验证失败:",o)}},se=o=>{N.info("添加跟进记录功能开发中")},de=o=>{k.closeReason="",k.convertToContract=!1,F.value=!0},ie=async()=>{if(L.value)try{await L.value.validate(),setTimeout(()=>{F.value=!1,N.success("关闭商机成功"),v()},500)}catch(o){console.error("表单验证失败:",o)}};return we(()=>{v()}),(o,t)=>{const b=r("el-icon"),i=r("el-button"),T=r("el-input"),s=r("el-form-item"),p=r("el-col"),n=r("el-option"),y=r("el-select"),J=r("el-row"),$=r("el-form"),c=r("el-table-column"),pe=r("el-tag"),me=r("el-switch"),fe=r("el-table"),ge=r("el-pagination"),ce=r("el-card"),_e=r("el-date-picker"),M=r("el-dialog"),ve=r("el-checkbox"),be=Ve("loading");return _(),R("div",Se,[e(ce,null,{header:l(()=>[d("div",ze,[t[25]||(t[25]=d("span",null,"商机管理",-1)),e(i,{type:"primary",onClick:le},{default:l(()=>[e(b,null,{default:l(()=>[e(w(ke))]),_:1}),t[24]||(t[24]=d("span",null,"新增商机",-1))]),_:1})])]),default:l(()=>[e($,{model:m,class:"search-form","label-width":"80px"},{default:l(()=>[e(J,{gutter:20},{default:l(()=>[e(p,{span:6},{default:l(()=>[e(s,{label:"商机名称"},{default:l(()=>[e(T,{modelValue:m.opportunityName,"onUpdate:modelValue":t[0]||(t[0]=a=>m.opportunityName=a),placeholder:"请输入商机名称",clearable:""},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(s,{label:"客户名称"},{default:l(()=>[e(y,{modelValue:m.customerId,"onUpdate:modelValue":t[1]||(t[1]=a=>m.customerId=a),placeholder:"请选择客户",clearable:""},{default:l(()=>[(_(!0),R(h,null,E(G.value,a=>(_(),S(n,{key:a.id,label:a.customerName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(s,{label:"商机阶段"},{default:l(()=>[e(y,{modelValue:m.stage,"onUpdate:modelValue":t[2]||(t[2]=a=>m.stage=a),placeholder:"请选择商机阶段",clearable:""},{default:l(()=>[e(n,{label:"初步接洽",value:"0"}),e(n,{label:"需求确认",value:"1"}),e(n,{label:"方案报价",value:"2"}),e(n,{label:"合同签订",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:6},{default:l(()=>[e(s,{label:"负责人"},{default:l(()=>[e(y,{modelValue:m.ownerId,"onUpdate:modelValue":t[3]||(t[3]=a=>m.ownerId=a),placeholder:"请选择负责人",clearable:""},{default:l(()=>[(_(!0),R(h,null,E(H.value,a=>(_(),S(n,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:24,class:"search-buttons"},{default:l(()=>[e(i,{type:"primary",onClick:X},{default:l(()=>[e(b,null,{default:l(()=>[e(w(Ce))]),_:1}),t[26]||(t[26]=d("span",null,"查询",-1))]),_:1}),e(i,{onClick:Y},{default:l(()=>[e(b,null,{default:l(()=>[e(w(xe))]),_:1}),t[27]||(t[27]=d("span",null,"重置",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),Ne((_(),S(fe,{data:A.value,style:{width:"100%"},border:""},{default:l(()=>[e(c,{prop:"id",label:"商机ID",width:"80"}),e(c,{prop:"opportunityName",label:"商机名称",width:"200"}),e(c,{prop:"customerName",label:"客户名称",width:"150"}),e(c,{prop:"stage",label:"商机阶段",width:"120"},{default:l(a=>[e(pe,{type:j[a.row.stage].type,effect:j[a.row.stage].effect},{default:l(()=>[x(K(j[a.row.stage].label),1)]),_:2},1032,["type","effect"])]),_:1}),e(c,{prop:"amount",label:"商机金额",width:"120"},{default:l(a=>[d("span",null,"¥"+K(a.row.amount.toFixed(2)),1)]),_:1}),e(c,{prop:"ownerName",label:"负责人",width:"100"}),e(c,{prop:"nextFollowTime",label:"下次跟进",width:"180"}),e(c,{prop:"status",label:"状态",width:"100"},{default:l(a=>[e(me,{modelValue:a.row.status,"onUpdate:modelValue":C=>a.row.status=C,"active-value":"1","inactive-value":"0",onChange:C=>ue(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(c,{prop:"createTime",label:"创建时间",width:"180"}),e(c,{label:"操作",width:"300",fixed:"right"},{default:l(a=>[e(i,{type:"primary",size:"small",onClick:C=>te(a.row)},{default:l(()=>[e(b,null,{default:l(()=>[e(w(Ie))]),_:1}),t[28]||(t[28]=d("span",null,"编辑",-1))]),_:1},8,["onClick"]),e(i,{type:"success",size:"small",onClick:C=>oe(a.row)},{default:l(()=>[e(b,null,{default:l(()=>[e(w(Te))]),_:1}),t[29]||(t[29]=d("span",null,"详情",-1))]),_:1},8,["onClick"]),e(i,{type:"warning",size:"small",onClick:C=>ne(a.row)},{default:l(()=>[e(b,null,{default:l(()=>[e(w(Ue))]),_:1}),t[30]||(t[30]=d("span",null,"更新阶段",-1))]),_:1},8,["onClick"]),e(i,{type:"info",size:"small",onClick:C=>se(a.row)},{default:l(()=>[e(b,null,{default:l(()=>[e(w(Fe))]),_:1}),t[31]||(t[31]=d("span",null,"跟进",-1))]),_:1},8,["onClick"]),e(i,{type:"danger",size:"small",onClick:C=>de(a.row)},{default:l(()=>[e(b,null,{default:l(()=>[e(w(Re))]),_:1}),t[32]||(t[32]=d("span",null,"关闭",-1))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[be,O.value]]),d("div",Oe,[e(ge,{"current-page":g.current,"onUpdate:currentPage":t[4]||(t[4]=a=>g.current=a),"page-size":g.size,"onUpdate:pageSize":t[5]||(t[5]=a=>g.size=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:g.total,onSizeChange:Z,onCurrentChange:ee},null,8,["current-page","page-size","total"])])]),_:1}),e(M,{modelValue:I.value,"onUpdate:modelValue":t[15]||(t[15]=a=>I.value=a),title:q.value==="add"?"新增商机":"编辑商机",width:"700px"},{footer:l(()=>[d("span",qe,[e(i,{onClick:t[14]||(t[14]=a=>I.value=!1)},{default:l(()=>[...t[33]||(t[33]=[x("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:ae},{default:l(()=>[...t[34]||(t[34]=[x("确定",-1)])]),_:1})])]),default:l(()=>[e($,{model:u,rules:P,ref_key:"opportunityFormRef",ref:D,"label-width":"100px"},{default:l(()=>[e(J,{gutter:20},{default:l(()=>[e(p,{span:12},{default:l(()=>[e(s,{prop:"opportunityName"},{default:l(()=>[e(T,{modelValue:u.opportunityName,"onUpdate:modelValue":t[6]||(t[6]=a=>u.opportunityName=a),placeholder:"请输入商机名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"customerId"},{default:l(()=>[e(y,{modelValue:u.customerId,"onUpdate:modelValue":t[7]||(t[7]=a=>u.customerId=a),placeholder:"请选择客户"},{default:l(()=>[(_(!0),R(h,null,E(G.value,a=>(_(),S(n,{key:a.id,label:a.customerName,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"stage"},{default:l(()=>[e(y,{modelValue:u.stage,"onUpdate:modelValue":t[8]||(t[8]=a=>u.stage=a),placeholder:"请选择商机阶段"},{default:l(()=>[e(n,{label:"初步接洽",value:"0"}),e(n,{label:"需求确认",value:"1"}),e(n,{label:"方案报价",value:"2"}),e(n,{label:"合同签订",value:"3"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"amount"},{default:l(()=>[e(T,{modelValue:u.amount,"onUpdate:modelValue":t[9]||(t[9]=a=>u.amount=a),type:"number",placeholder:"请输入商机金额"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"ownerId"},{default:l(()=>[e(y,{modelValue:u.ownerId,"onUpdate:modelValue":t[10]||(t[10]=a=>u.ownerId=a),placeholder:"请选择负责人"},{default:l(()=>[(_(!0),R(h,null,E(H.value,a=>(_(),S(n,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"nextFollowTime"},{default:l(()=>[e(_e,{modelValue:u.nextFollowTime,"onUpdate:modelValue":t[11]||(t[11]=a=>u.nextFollowTime=a),type:"datetime",placeholder:"请选择下次跟进时间",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:24},{default:l(()=>[e(s,{prop:"description"},{default:l(()=>[e(T,{modelValue:u.description,"onUpdate:modelValue":t[12]||(t[12]=a=>u.description=a),type:"textarea",placeholder:"请输入商机描述"},null,8,["modelValue"])]),_:1})]),_:1}),e(p,{span:12},{default:l(()=>[e(s,{prop:"status"},{default:l(()=>[e(y,{modelValue:u.status,"onUpdate:modelValue":t[13]||(t[13]=a=>u.status=a),placeholder:"请选择状态"},{default:l(()=>[e(n,{label:"启用",value:"1"}),e(n,{label:"禁用",value:"0"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(M,{modelValue:U.value,"onUpdate:modelValue":t[19]||(t[19]=a=>U.value=a),title:"更新商机阶段",width:"400px"},{footer:l(()=>[d("span",$e,[e(i,{onClick:t[18]||(t[18]=a=>U.value=!1)},{default:l(()=>[...t[35]||(t[35]=[x("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:re},{default:l(()=>[...t[36]||(t[36]=[x("确定",-1)])]),_:1})])]),default:l(()=>[e($,{model:V,rules:Q,ref_key:"updateStageFormRef",ref:B},{default:l(()=>[e(s,{label:"商机阶段",prop:"stage"},{default:l(()=>[e(y,{modelValue:V.stage,"onUpdate:modelValue":t[16]||(t[16]=a=>V.stage=a),placeholder:"请选择商机阶段"},{default:l(()=>[e(n,{label:"初步接洽",value:"0"}),e(n,{label:"需求确认",value:"1"}),e(n,{label:"方案报价",value:"2"}),e(n,{label:"合同签订",value:"3"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"备注",prop:"remark"},{default:l(()=>[e(T,{modelValue:V.remark,"onUpdate:modelValue":t[17]||(t[17]=a=>V.remark=a),type:"textarea",placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(M,{modelValue:F.value,"onUpdate:modelValue":t[23]||(t[23]=a=>F.value=a),title:"关闭商机",width:"400px"},{footer:l(()=>[d("span",he,[e(i,{onClick:t[22]||(t[22]=a=>F.value=!1)},{default:l(()=>[...t[37]||(t[37]=[x("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:ie},{default:l(()=>[...t[38]||(t[38]=[x("确定",-1)])]),_:1})])]),default:l(()=>[e($,{model:k,rules:W,ref_key:"closeOpportunityFormRef",ref:L},{default:l(()=>[e(s,{label:"关闭原因",prop:"closeReason"},{default:l(()=>[e(T,{modelValue:k.closeReason,"onUpdate:modelValue":t[20]||(t[20]=a=>k.closeReason=a),type:"textarea",placeholder:"请输入关闭原因"},null,8,["modelValue"])]),_:1}),e(s,{label:"是否转化为合同"},{default:l(()=>[e(ve,{modelValue:k.convertToContract,"onUpdate:modelValue":t[21]||(t[21]=a=>k.convertToContract=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Be=ye(Ee,[["__scopeId","data-v-c6d3c0b2"]]);export{Be as default};
